-- ============================================
-- PTI Calendar V4 - Seeds: RDV
-- ============================================
-- Génération de RDV pour tests et démonstrations
-- Dates relatives à aujourd'hui pour garder les données fraîches

-- ============================================
-- RDV PASSÉS (Historique)
-- ============================================
INSERT INTO rdv (id, tenant_id, centre_id, client_id, vehicule_id, controleur_id, date_rdv, heure_debut, heure_fin, duree_minutes, type_controle, status, source, montant_ht, montant_tva, montant_ttc, paiement_status, paiement_id, reference, notes, resultat_controle, created_at, updated_at) VALUES
-- RDV terminés centre Paris 11
(
  'rdv-hist-001',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-001',
  'vehicule-001',
  'ctrl-paris11-001',
  CURRENT_DATE - INTERVAL '30 days',
  '09:00',
  '09:40',
  40,
  'CTP',
  'termine',
  'web',
  6250,
  1250,
  7500,
  'completed',
  'pi_hist001',
  'RDV-2024-001234',
  NULL,
  '{"favorable": true, "date_resultat": "2024-01-15", "defauts_majeurs": 0, "defauts_mineurs": 1}'::jsonb,
  NOW() - INTERVAL '30 days',
  NOW() - INTERVAL '30 days'
),
(
  'rdv-hist-002',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-002',
  'vehicule-003',
  'ctrl-paris11-002',
  CURRENT_DATE - INTERVAL '25 days',
  '10:00',
  '10:45',
  45,
  'CTP',
  'termine',
  'call_center',
  6250,
  1250,
  7500,
  'completed',
  'pi_hist002',
  'RDV-2024-001235',
  NULL,
  '{"favorable": false, "date_resultat": "2024-01-20", "defauts_majeurs": 2, "defauts_mineurs": 3, "date_limite_contre_visite": "2024-03-20"}'::jsonb,
  NOW() - INTERVAL '25 days',
  NOW() - INTERVAL '25 days'
),
(
  'rdv-hist-003',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-002',
  'vehicule-003',
  'ctrl-paris11-001',
  CURRENT_DATE - INTERVAL '20 days',
  '14:00',
  '14:30',
  30,
  'CVP',
  'termine',
  'web',
  2917,
  583,
  3500,
  'completed',
  'pi_hist003',
  'RDV-2024-001250',
  'Contre-visite suite à défauts freinage',
  '{"favorable": true, "date_resultat": "2024-01-25", "defauts_majeurs": 0, "defauts_mineurs": 0}'::jsonb,
  NOW() - INTERVAL '20 days',
  NOW() - INTERVAL '20 days'
),
-- RDV annulé
(
  'rdv-hist-004',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-003',
  'vehicule-004',
  NULL,
  CURRENT_DATE - INTERVAL '15 days',
  '11:00',
  '11:40',
  40,
  'CTP',
  'annule',
  'web',
  6250,
  1250,
  7500,
  'refunded',
  'pi_hist004',
  'RDV-2024-001260',
  'Annulé par client - indisponibilité',
  NULL,
  NOW() - INTERVAL '15 days',
  NOW() - INTERVAL '14 days'
),
-- RDV absent
(
  'rdv-hist-005',
  '22222222-2222-2222-2222-222222222222',
  'centre-lyon-3',
  'client-part-003',
  'vehicule-004',
  'ctrl-lyon3-001',
  CURRENT_DATE - INTERVAL '10 days',
  '09:30',
  '10:10',
  40,
  'CTP',
  'absent',
  'call_center',
  5833,
  1167,
  7000,
  'completed',
  'pi_hist005',
  'RDV-2024-001280',
  'Client ne s''est pas présenté',
  NULL,
  NOW() - INTERVAL '10 days',
  NOW() - INTERVAL '10 days'
),
-- RDV Marseille
(
  'rdv-hist-006',
  '33333333-3333-3333-3333-333333333333',
  'centre-marseille-01',
  'client-part-005',
  'vehicule-005',
  'ctrl-marseille-001',
  CURRENT_DATE - INTERVAL '7 days',
  '15:00',
  '15:35',
  35,
  'CTP',
  'termine',
  'web',
  5417,
  1083,
  6500,
  'completed',
  'pi_hist006',
  'RDV-2024-002001',
  'Véhicule électrique',
  '{"favorable": true, "date_resultat": "2024-02-08", "defauts_majeurs": 0, "defauts_mineurs": 0}'::jsonb,
  NOW() - INTERVAL '7 days',
  NOW() - INTERVAL '7 days'
);

-- ============================================
-- RDV AUJOURD'HUI
-- ============================================
INSERT INTO rdv (id, tenant_id, centre_id, client_id, vehicule_id, controleur_id, date_rdv, heure_debut, heure_fin, duree_minutes, type_controle, status, source, montant_ht, montant_tva, montant_ttc, paiement_status, paiement_id, reference, notes, created_at, updated_at) VALUES
-- Paris 11 - Aujourd'hui
(
  'rdv-today-001',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-001',
  'vehicule-002',
  'ctrl-paris11-001',
  CURRENT_DATE,
  '08:00',
  '08:40',
  40,
  'CTP',
  'termine',
  'web',
  6250,
  1250,
  7500,
  'completed',
  'pi_today001',
  'RDV-2024-003001',
  NULL,
  NOW() - INTERVAL '1 day',
  NOW()
),
(
  'rdv-today-002',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-pro-001',
  'vehicule-007',
  'ctrl-paris11-002',
  CURRENT_DATE,
  '08:45',
  '09:30',
  45,
  'CTP',
  'en_cours',
  'backoffice',
  7083,
  1417,
  8500,
  'completed',
  'pi_today002',
  'RDV-2024-003002',
  'Véhicule utilitaire flotte entreprise',
  NOW() - INTERVAL '2 days',
  NOW()
),
(
  'rdv-today-003',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-004',
  NULL,
  'ctrl-paris11-003',
  CURRENT_DATE,
  '09:30',
  '10:10',
  40,
  'CTP',
  'confirme',
  'web',
  6250,
  1250,
  7500,
  'completed',
  'pi_today003',
  'RDV-2024-003003',
  NULL,
  NOW() - INTERVAL '3 days',
  NOW()
),
(
  'rdv-today-004',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-002',
  'vehicule-003',
  'ctrl-paris11-001',
  CURRENT_DATE,
  '10:15',
  '11:00',
  45,
  'CTP',
  'confirme',
  'call_center',
  6250,
  1250,
  7500,
  'completed',
  'pi_today004',
  'RDV-2024-003004',
  NULL,
  NOW() - INTERVAL '1 day',
  NOW()
),
(
  'rdv-today-005',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-pro-001',
  'vehicule-008',
  'ctrl-paris11-002',
  CURRENT_DATE,
  '11:00',
  '11:45',
  45,
  'CTP',
  'en_attente',
  'api',
  7083,
  1417,
  8500,
  'pending',
  NULL,
  'RDV-2024-003005',
  'Flotte Transport Express',
  NOW() - INTERVAL '4 hours',
  NOW()
),
-- Lyon - Aujourd'hui
(
  'rdv-today-006',
  '22222222-2222-2222-2222-222222222222',
  'centre-lyon-3',
  'client-part-003',
  'vehicule-004',
  'ctrl-lyon3-001',
  CURRENT_DATE,
  '09:00',
  '09:40',
  40,
  'CTP',
  'confirme',
  'web',
  5833,
  1167,
  7000,
  'completed',
  'pi_today006',
  'RDV-2024-003010',
  'Véhicule hybride',
  NOW() - INTERVAL '5 days',
  NOW()
),
(
  'rdv-today-007',
  '22222222-2222-2222-2222-222222222222',
  'centre-lyon-3',
  'client-pro-001',
  'vehicule-009',
  'ctrl-lyon3-002',
  CURRENT_DATE,
  '10:00',
  '11:00',
  60,
  'CTP',
  'en_attente',
  'call_center',
  10000,
  2000,
  12000,
  'pending',
  NULL,
  'RDV-2024-003011',
  'Poids lourd 4.5T',
  NOW() - INTERVAL '2 days',
  NOW()
),
-- Marseille - Aujourd'hui
(
  'rdv-today-008',
  '33333333-3333-3333-3333-333333333333',
  'centre-marseille-01',
  'client-part-006',
  'vehicule-006',
  'ctrl-marseille-001',
  CURRENT_DATE,
  '10:00',
  '10:30',
  30,
  'CTP',
  'confirme',
  'web',
  3750,
  750,
  4500,
  'completed',
  'pi_today008',
  'RDV-2024-003020',
  'Moto BMW GS',
  NOW() - INTERVAL '3 days',
  NOW()
),
(
  'rdv-today-009',
  '33333333-3333-3333-3333-333333333333',
  'centre-marseille-01',
  'client-pro-002',
  'vehicule-010',
  'ctrl-marseille-002',
  CURRENT_DATE,
  '14:00',
  '14:35',
  35,
  'CTP',
  'confirme',
  'backoffice',
  5417,
  1083,
  6500,
  'completed',
  'pi_today009',
  'RDV-2024-003021',
  'Flotte électrique AutoLoc',
  NOW() - INTERVAL '1 day',
  NOW()
);

-- ============================================
-- RDV FUTURS (Prochains jours)
-- ============================================
INSERT INTO rdv (id, tenant_id, centre_id, client_id, vehicule_id, controleur_id, date_rdv, heure_debut, heure_fin, duree_minutes, type_controle, status, source, montant_ht, montant_tva, montant_ttc, paiement_status, paiement_id, reference, notes, created_at, updated_at) VALUES
-- Demain - Paris 11
(
  'rdv-fut-001',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-001',
  'vehicule-001',
  'ctrl-paris11-001',
  CURRENT_DATE + INTERVAL '1 day',
  '09:00',
  '09:40',
  40,
  'CTP',
  'confirme',
  'web',
  6250,
  1250,
  7500,
  'completed',
  'pi_fut001',
  'RDV-2024-004001',
  NULL,
  NOW() - INTERVAL '5 days',
  NOW()
),
(
  'rdv-fut-002',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-004',
  NULL,
  'ctrl-paris11-002',
  CURRENT_DATE + INTERVAL '1 day',
  '10:00',
  '10:40',
  40,
  'CTP',
  'en_attente',
  'call_center',
  6250,
  1250,
  7500,
  'pending',
  NULL,
  'RDV-2024-004002',
  NULL,
  NOW() - INTERVAL '1 day',
  NOW()
),
-- Dans 2 jours
(
  'rdv-fut-003',
  '22222222-2222-2222-2222-222222222222',
  'centre-lyon-3',
  'client-part-003',
  'vehicule-004',
  'ctrl-lyon3-001',
  CURRENT_DATE + INTERVAL '2 days',
  '14:00',
  '14:40',
  40,
  'CTP',
  'confirme',
  'web',
  5833,
  1167,
  7000,
  'completed',
  'pi_fut003',
  'RDV-2024-004010',
  NULL,
  NOW() - INTERVAL '3 days',
  NOW()
),
-- Dans 3 jours
(
  'rdv-fut-004',
  '33333333-3333-3333-3333-333333333333',
  'centre-marseille-01',
  'client-pro-002',
  'vehicule-011',
  'ctrl-marseille-001',
  CURRENT_DATE + INTERVAL '3 days',
  '09:00',
  '09:40',
  40,
  'CTP',
  'en_attente',
  'api',
  5417,
  1083,
  6500,
  'pending',
  NULL,
  'RDV-2024-004020',
  'Flotte AutoLoc',
  NOW() - INTERVAL '1 day',
  NOW()
),
(
  'rdv-fut-005',
  '33333333-3333-3333-3333-333333333333',
  'centre-marseille-01',
  'client-pro-002',
  'vehicule-012',
  'ctrl-marseille-002',
  CURRENT_DATE + INTERVAL '3 days',
  '10:00',
  '10:35',
  35,
  'CTP',
  'en_attente',
  'api',
  5417,
  1083,
  6500,
  'pending',
  NULL,
  'RDV-2024-004021',
  'Flotte électrique AutoLoc',
  NOW() - INTERVAL '1 day',
  NOW()
),
-- Semaine prochaine
(
  'rdv-fut-006',
  '22222222-2222-2222-2222-222222222222',
  'centre-paris-11',
  'client-part-002',
  'vehicule-003',
  NULL,
  CURRENT_DATE + INTERVAL '7 days',
  '11:00',
  '11:40',
  40,
  'CTP',
  'en_attente',
  'web',
  6250,
  1250,
  7500,
  'pending',
  NULL,
  'RDV-2024-004030',
  NULL,
  NOW(),
  NOW()
),
(
  'rdv-fut-007',
  '22222222-2222-2222-2222-222222222222',
  'centre-toulouse-01',
  'client-part-004',
  NULL,
  NULL,
  CURRENT_DATE + INTERVAL '10 days',
  '15:00',
  '15:40',
  40,
  'CTP',
  'en_attente',
  'call_center',
  5833,
  1167,
  7000,
  'pending',
  NULL,
  'RDV-2024-004040',
  NULL,
  NOW(),
  NOW()
);

-- ============================================
-- HISTORIQUE DES RDV (Audit trail)
-- ============================================
INSERT INTO rdv_history (id, tenant_id, rdv_id, action, ancien_status, nouveau_status, modifications, utilisateur_id, commentaire, created_at) VALUES
(
  uuid_generate_v4(),
  '22222222-2222-2222-2222-222222222222',
  'rdv-today-001',
  'CREATION',
  NULL,
  'en_attente',
  NULL,
  NULL,
  'RDV créé via interface web',
  NOW() - INTERVAL '1 day'
),
(
  uuid_generate_v4(),
  '22222222-2222-2222-2222-222222222222',
  'rdv-today-001',
  'PAIEMENT',
  'en_attente',
  'en_attente_paiement',
  '{"paiement_status": {"ancien": "pending", "nouveau": "processing"}}'::jsonb,
  NULL,
  'Paiement en cours',
  NOW() - INTERVAL '1 day'
),
(
  uuid_generate_v4(),
  '22222222-2222-2222-2222-222222222222',
  'rdv-today-001',
  'CONFIRMATION',
  'en_attente_paiement',
  'confirme',
  '{"paiement_status": {"ancien": "processing", "nouveau": "completed"}}'::jsonb,
  NULL,
  'RDV confirmé automatiquement après paiement',
  NOW() - INTERVAL '1 day'
),
(
  uuid_generate_v4(),
  '22222222-2222-2222-2222-222222222222',
  'rdv-today-001',
  'DEBUT_CONTROLE',
  'confirme',
  'en_cours',
  NULL,
  'user-ctrl-paris11-001',
  'Contrôle démarré',
  NOW() - INTERVAL '30 minutes'
),
(
  uuid_generate_v4(),
  '22222222-2222-2222-2222-222222222222',
  'rdv-today-001',
  'FIN_CONTROLE',
  'en_cours',
  'termine',
  '{"resultat": {"ancien": null, "nouveau": "favorable"}}'::jsonb,
  'user-ctrl-paris11-001',
  'Contrôle terminé - favorable',
  NOW()
);

SELECT 'Seeds RDV créés avec succès' AS status;
